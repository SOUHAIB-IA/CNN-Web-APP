{% extends "base.html" %}

{% block title %}Home - My Flask App{% endblock %}

{% block content %}
<div class="container mx-auto mt-10">
    <!-- Data Upload Section -->
    <form action="/upload" method="POST" enctype="multipart/form-data">
        <div class="bg-white p-6 rounded-lg shadow-md">
            <h2 class="text-2xl font-semibold mb-4">Upload Data</h2>
            <input type="file" name="file" id="dataFile" class="block w-full text-gray-600 mb-4" />
            <button type="submit" class="w-full bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                Upload
            </button>
        </div>
    </form>

    <!-- Data Preview Section -->
    {% if data_preview is not none and not data_preview.empty %}
    <div class="mt-8">
        <h2 class="text-2xl font-semibold mb-4">Data Preview</h2>
        <div class="bg-white p-6 rounded-lg shadow-md overflow-x-auto">
            <table class="w-full bg-white border-collapse">
                <thead>
                    <tr>
                        {% for column in data_preview.columns %}
                        <th class="px-4 py-2 border border-gray-400 text-center bg-gray-100 font-bold">
                            {{ column }}
                        </th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    {% for row in data_preview.itertuples() %}
                    <tr class="even:bg-gray-50 odd:bg-white">
                        {% for value in row[1:] %}
                        <td class="px-4 py-2 border border-gray-400 text-left">{{ value }}</td>
                        {% endfor %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}

    <!-- Model Configuration Form -->
    <form action="/get_config" method="post" enctype="multipart/form-data">
        <div class="mt-8 bg-white p-6 rounded-lg shadow-md">
            <h2 class="text-2xl font-semibold mb-4">Configure CNN Model</h2>

            <!-- Number of Layers -->
            <div class="mb-4">
                <label class="block text-gray-700">Number of Layers:</label>
                <input type="number" name="numLayers" id="numLayers" min="1" class="w-full border rounded p-2"
                    placeholder="Enter number of layers" onchange="generateLayerConfig()" required />
            </div>

            <!-- Layer Configuration Section (dynamically generated) -->
            <div id="layerConfigSection"></div>

            <!-- Optimizer -->
            <div class="mt-4">
                <label class="block text-gray-700">Optimizer:</label>
                <select name="optimizer" class="w-full border rounded p-2">
                    <option value="adam">Adam</option>
                    <option value="sgd">SGD</option>
                    <option value="rmsprop">RMSprop</option>
                    <option value="adagrad">Adagrad</option>
                </select>
            </div>

            <!-- Learning Rate -->
            <div class="mt-4">
                <label class="block text-gray-700">Learning Rate:</label>
                <input type="number" name="learning_rate" step="0.0001" min="0" class="w-full border rounded p-2"
                    placeholder="Enter learning rate" required />
            </div>

            <!-- Batch Size -->
            <div class="mt-4">
                <label class="block text-gray-700">Batch Size:</label>
                <input type="number" name="batch_size" min="1" class="w-full border rounded p-2"
                    placeholder="Enter batch size" required />
            </div>

            <!-- Number of Epochs -->
            <div class="mt-4">
                <label class="block text-gray-700">Number of Epochs:</label>
                <input type="number" name="epochs" min="1" class="w-full border rounded p-2"
                    placeholder="Enter number of epochs" required />
            </div>

            <!-- Dropout Rate -->
            <div class="mt-4">
                <label class="block text-gray-700">Dropout Rate:</label>
                <input type="number" name="dropout_rate" step="0.01" min="0" max="1" class="w-full border rounded p-2"
                    placeholder="Enter dropout rate (0.0 - 1.0)" required />
            </div>

            <!-- Button to Save Configuration -->
            <button type="submit" class="w-full bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 mt-4">
                Save Configuration
            </button>
        </div>
    </form>
    {% with messages = get_flashed_messages() %}
        {% if messages %}
            <ul>
            {% for message in messages %}
                <li>{{ message }}</li>
            {% endfor %}
            </ul>
        {% endif %}
    {% endwith %}

    <!-- Training Status -->
    <div class="mt-10 bg-white p-6 rounded-lg shadow-md">
        <h2 class="text-2xl font-semibold mb-4">Training Status</h2>
        <p class="text-gray-600">Training in progress...</p>
        <div class="w-full bg-gray-200 rounded-full h-2.5 mt-4">
            <div class="bg-blue-500 h-2.5 rounded-full" style="width: 45%;"></div>
        </div>
    </div>

    <!-- Graphs Section -->
    <div class="mt-10 bg-white p-6 rounded-lg shadow-md">
        <h2 class="text-2xl font-semibold mb-4">Training Results</h2>
        <canvas id="lossChart" class="w-full h-64"></canvas>
    </div>
</div>

<!-- JavaScript to dynamically generate the layer configurations -->
<script>
    function generateLayerConfig() {
        const numLayers = document.getElementById('numLayers').value;
        const layerConfigSection = document.getElementById('layerConfigSection');
        layerConfigSection.innerHTML = ''; // Clear any previous layer configurations

        for (let i = 1; i <= numLayers; i++) {
            const layerDiv = document.createElement('div');
            layerDiv.className = "border-t border-gray-200 mt-4 pt-4";

            const layerHeading = document.createElement('h3');
            layerHeading.className = "text-xl font-semibold mb-4";
            layerHeading.innerText = `Layer ${i}`;
            layerDiv.appendChild(layerHeading);

            const nbrlayers = document.createElement('div');
            nbrlayers.className = "mb-4";
            nbrlayers.innerHTML = `
                <label class="block text-gray-700">Number of Neurons (Layer ${i}):</label>
                <input type="number" name="neurons_layer_${i}" min="1" class="w-full border rounded p-2"
                    placeholder="Enter number of neurons for Layer ${i}" required />
            `;
            layerDiv.appendChild(nbrlayers);

            const activationDiv = document.createElement('div');
            activationDiv.className = 'mb-4';
            activationDiv.innerHTML = `
                <label class="block text-gray-700">Activation Function (Layer ${i}):</label>
                <select name="activation_layer_${i}" class="w-full border rounded p-2">
                    <option value="relu">ReLU</option>
                    <option value="sigmoid">Sigmoid</option>
                    <option value="tanh">Tanh</option>
                    <option value="softmax">Softmax</option>
                </select>
            `;
            layerDiv.appendChild(activationDiv);

            layerConfigSection.appendChild(layerDiv);
        }
    }
</script>
{% endblock %}
